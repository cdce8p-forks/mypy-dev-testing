name: Tag version

on:
  workflow_dispatch:
    inputs:
      name:
        type: string
        required: true
      commit:
        type: string
        default: HEAD

jobs:
  tag_version:
    name: Tag new mypy-dev version
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/setup-python@v6
        name: Install Python
        with:
          python-version: "3.13"
      # - uses: actions/create-github-app-token@a8d616148505b5069dccd32f177bb87d7f39123b # v2.1.1
      #   id: app-token
      #   with:
      #     app-id: ${{ vars.APP_ID }}
      #     private-key: ${{ secrets.PRIVATE_KEY }}
      #     permission-contents: write # push branch to Github
      - uses: actions/checkout@v5
        with:
          submodules: recursive
          # token: ${{ steps.app-token.outputs.token }}
      # - name: Set git config
      #   run: |
      #     git config --global user.name "${{ vars.BOT_NAME }}"
      #     git config --global user.email "${{ vars.BOT_EMAIL }}"
      - name: Set git config
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email '41898282+github-actions[bot]@users.noreply.github.com'
      - name: Fetch and checkout
        run: |
          git -C mypy fetch origin --no-tags -t master
          git -C mypy checkout ${{ inputs.commit }}
          git -C mypy log -1
      # - name: Get new tag version
      #   id: new-tag
      #   run: python scripts/new_tag.py
      - name: Commit and push
        run: |
          git status
          git add --update
          git status
          git commit -m "Update mypy commit"
          git log
          tag_name="${{ inputs.name }}"
          git tag "${tag_name}"  # TODO <= !!
          git log -1
          git push origin main "${tag_name}"
